function ListItem(e,t,r,n,l,i,o){var s=this
s.Title=ko.observable(decodeEncodedJson(e)).extend({required:"Title is required"}),s.Description=ko.observable(decodeEncodedJson(t)),s.FullSizeUrl=ko.observable(r),s.ResizedUrl=ko.observable(n),s.ThumbnailUrl=ko.observable(l),s.LinkUrl=ko.observable(i).extend({required:"Link Url is required",isValidUrl:"Must be a valid url"}),s.Sort=ko.observable(o),s.incrementSort=function(){s.Sort(s.Sort()+3)},s.decrementSort=function(){var e=s.Sort()-3
0>e&&(e=0),s.Sort(e)},s._testEle=null,s.isValidUrl=function(e){s._testEle||(s._testEle=document.createElement("input"),s._testEle.setAttribute("type","url")),s._testEle.value=e
var t=s._testEle.validity.valid
return t}}function ItemListViewModel(e){var t=this
t.hiddenField=document.getElementById("ItemsJson"),t.handleSortItemChanged=function(e){t.sortItems()
var r=1
for(i=0;i<t.Items().length;i++){var n=t.Items()[i]
n.Sort.silentUpdate(r),r+=2}t.sortItems()},t.Items=ko.observableArray(ko.utils.arrayMap(e,function(e){var e=new ListItem(e.Title,e.Description,e.FullSizeUrl,e.ResizedUrl,e.ThumbnailUrl,e.LinkUrl,e.Sort)
return e.Sort.subscribe(t.handleSortItemChanged),e})),t.addItem=function(e,r,n,l,i,o,s){var a=new ListItem(e,r,n,l,i,o,s)
a.Sort.subscribe(t.handleSortItemChanged),t.Items.push(a)},t.newItemTitle=ko.observable(null).extend({required:"Title is required"}),t.newItemDescription=ko.observable(null),t.newItemFullSizeUrl=ko.observable(null),t.newItemResizedUrl=ko.observable(null),t.newItemThumbnailUrl=ko.observable(null),t.newItemLinkUrl=ko.observable(null).extend({isValidUrl:null}),t.newItemSort=function(){if(0===t.Items().length)return 1
var e=Math.max.apply(Math,t.Items().map(function(e){return e.Sort()}))
return e+2},t.addNewItem=function(){t.addItem(t.newItemTitle(),t.newItemDescription(),t.newItemFullSizeUrl(),t.newItemResizedUrl(),t.newItemThumbnailUrl(),t.newItemLinkUrl(),t.newItemSort()),t.newItemTitle(null),t.newItemDescription(null),t.newItemFullSizeUrl(null),t.newItemResizedUrl(null),t.newItemThumbnailUrl(null),t.newItemLinkUrl(null),window.cloudscribeDropAndCrop.clearAllItems()},t.removeItem=function(e){t.Items.remove(e)},t.getCssClass=function(e){return 0===e?"carousel-item active":"carousel-item"},t.dropZoneSuccess=function(e,r){t.newItemFullSizeUrl(r[0].originalUrl),t.newItemResizedUrl(r[0].resizedUrl),t.newItemThumbnailUrl(r[0].thumbUrl)},window.DropZoneSuccessHandler=t.dropZoneSuccess,t.handleCropSave=function(e){t.newItemResizedUrl(e)},window.HandleCropResult=t.handleCropSave,t.serverFileSelected=function(e){t.newItemResizedUrl(e)},window.ServerFileSelected=t.serverFileSelected,t.filteredItems=ko.computed(function(){return ko.utils.arrayFilter(t.Items(),function(e){return 0==e.LinkUrl.hasError()&&0==e.Title.hasError()})}),t.currentListState=ko.computed(function(){return encodeURIComponent(ko.toJSON(t.filteredItems()))}),t.sortItems=function(){t.Items.sort(function(e,t){return e.Sort()<t.Sort()?-1:e.Sort()>t.Sort()?1:0})},t._testEle=null,t.isValidNewItemLink=ko.computed(function(){return t.newItemTitle.hasError()?!1:t.newItemLinkUrl.hasError()?!1:!0})}function decodeEncodedJson(e){if(null===e)return e
if(void 0===e)return e
var t=e.replace(/\+/g," ")
return decodeURIComponent(t)}ko.observable.fn.silentUpdate=function(e){this.notifySubscribers=function(){},this(e),this.notifySubscribers=function(){ko.subscribable.fn.notifySubscribers.apply(this,arguments)}},ko.extenders.required=function(e,t){function r(r){e.hasError(r?!1:!0),e.validationMessage(r?"":t||"This field is required")}return e.hasError=ko.observable(),e.validationMessage=ko.observable(),r(e()),e.subscribe(r),e},ko.extenders.isValidUrl=function(e,t){function r(t){if(t){self._testEle||(n=document.createElement("input"),n.setAttribute("type","url")),n.value=t
var r=n.validity.valid
r?(e.hasError(!1),e.validationMessage("")):(e.hasError(!0),e.validationMessage("Must be a valid url"))}else e.hasError(t?!1:!0),e.validationMessage(t?"":"Url is required")}e.hasError=ko.observable(),e.validationMessage=ko.observable()
var n=null
return r(e()),e.subscribe(r),e},document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("ItemsConfig"),t=JSON.parse(decodeEncodedJson(e.value))
ko.applyBindings(new ItemListViewModel(t))})
