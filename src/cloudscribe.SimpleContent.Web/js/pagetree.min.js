$(function(){var n={ui:{treeDiv:$("#tree1"),cmdBarDiv:$("#cmdBar"),selectedPageInput:$("#hdnSelPage"),cmdHeading:$("#cmdHeading"),sortLi:$("#liSort"),editLi:$("#liEdit"),deleteLi:$("#liDelete"),newChildLi:$("#liNewChild"),editLink:$("#lnkEdit"),viewLink:$("#lnkView"),sortButton:$("#lnkSort"),newChildLink:$("#lnkNewChild"),deleteButton:$("#lnkDeletePage"),pubStatusLabel:$("#spnPubStatus")},urls:{treeDataUrl:$("#config").data("service-url"),sortUrl:$("#config").data("sort-url"),moveUrl:$("#config").data("move-url"),deleteUrl:$("#config").data("delete-url"),editUrl:$("#config").data("edit-url")},xsrfToken:$('[name="__RequestVerificationToken"]:first').val(),showCommands:function(t){n.ui.selectedPageInput.val(t.id);n.ui.cmdHeading.html(t.name);n.ui.editLink.attr("href",this.urls.editUrl+"/"+t.slug);n.ui.viewLink.attr("href",t.url);n.ui.newChildLink.attr("href",this.urls.editUrl+"?parentslug="+t.slug);n.ui.pubStatusLabel.html(t.pubstatus);n.ui.cmdBarDiv.show();new Tether({element:".commandPanel",target:".jqtree-selected",attachment:"top left",targetAttachment:"top right"});t.childcount>1?n.ui.sortLi.show():n.ui.sortLi.hide();t.canEdit?n.ui.editLi.show():n.ui.editLi.hide();t.canDelete?n.ui.deleteLi.show():n.ui.deleteLi.hide();t.canCreateChild?n.ui.newChildLi.show():n.ui.newChildLi.hide()},moveNode:function(t,i,r,u){var f={},e;return f.movedNode=t.id,f.targetNode=i.id,f.previousParent=r.id,f.position=u,e=!1,$.ajax({type:"POST",url:n.urls.moveUrl,async:!1,headers:{"X-XSRF-TOKEN":this.xsrfToken},dataType:"json",data:f,success:function(n){n.success?e=!0:alert(n.message)},complete:function(){},error:function(n,t,i){alert(i)}}),e},init:function(){this.ui.sortButton.click(function(t){if(t.preventDefault(),confirm("Are you sure you want to sort the child pages alphabetically?")){var i=n.ui.treeDiv.tree("getNodeById",n.ui.selectedPageInput.val()),r={};r.pageId=i.id;$.ajax({type:"POST",url:n.urls.sortUrl,headers:{"X-XSRF-TOKEN":n.xsrfToken},async:!1,processData:!0,dataType:"json",data:r,success:function(t){t.success?n.ui.treeDiv.tree("loadDataFromUrl",i):alert(t.message)},complete:function(){},error:function(n,t,i){alert(i)}})}});n.ui.deleteButton.click(function(t){var i,r,u;t.preventDefault();i=n.ui.treeDiv.tree("getNodeById",n.ui.selectedPageInput.val());r=!1;i.childcount>0?confirm("Are you sure you want to delete the page and all of it's child pages?")&&(r=!0):confirm("Are you sure you want to delete the page?")&&(r=!0);r&&(u={},u.id=i.id,$.ajax({type:"POST",url:n.urls.deleteUrl,headers:{"X-XSRF-TOKEN":n.xsrfToken},async:!1,dataType:"json",data:u,success:function(t){t.success?n.ui.treeDiv.tree("removeNode",i):alert(t.message)},complete:function(){},error:function(n,t){alert(t)}}))});n.ui.treeDiv.tree({dataUrl:n.urls.treeDataUrl,dragAndDrop:!0,onLoadFailed:function(n){alert(n)}});n.ui.treeDiv.bind("tree.click",function(n){var t=n.node});n.ui.treeDiv.bind("tree.dblclick",function(){console.log(e.node)});n.ui.treeDiv.bind("tree.select",function(t){if(t.node)n.showCommands(t.node);else{var i=t.previous_node;n.ui.selectedPageInput.val(-1);n.ui.cmdBarDiv.hide()}});n.ui.treeDiv.bind("tree.contextmenu",function(n){var t=n.node});n.ui.treeDiv.bind("tree.move",function(t){t.preventDefault();confirm("are you sure you want to move the node")&&n.moveNode(t.move_info.moved_node,t.move_info.target_node,t.move_info.previous_parent,t.move_info.position)&&t.move_info.do_move()});n.ui.treeDiv.bind("tree.init",function(){});n.ui.treeDiv.bind("tree.open",function(t){n.ui.treeDiv.tree("selectNode",null);n.ui.treeDiv.tree("selectNode",t.node)});n.ui.treeDiv.bind("tree.close",function(t){n.ui.treeDiv.tree("selectNode",null);n.ui.treeDiv.tree("selectNode",t.node)})}};n.init()});